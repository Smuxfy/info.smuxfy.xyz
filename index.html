<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visitor Info</title>
<style>
  body {
    background: #0b1221;
    color: #e6eef8;
    font-family: sans-serif;
    padding: 20px;
  }
  h1 { color: #4f9eff; }
  table { width: 100%; max-width: 800px; border-collapse: collapse; }
  td { padding: 6px 10px; border-bottom: 1px solid rgba(255,255,255,0.1); }
  td.label { font-weight: bold; color: #66f0a1; width: 180px; }
  td.value { color: #e6eef8; }
</style>
</head>
<body>
<h1>Visitor Information</h1>
<table id="info">
  <tbody>
    <tr><td class="label">Loading...</td><td class="value"></td></tr>
  </tbody>
</table>

<script>
// Measure ping by fetching the page itself
async function getPing() {
  const start = Date.now();
  try {
    await fetch(window.location.href, { cache: 'no-store' });
    const end = Date.now();
    return end - start;
  } catch {
    return 'Ping failed';
  }
}

// Function to get IP & location from ipapi.co
async function getIPInfo() {
  try {
    const response = await fetch('https://ipapi.co/json/');
    const data = await response.json();
    return {
      ip: data.ip,
      country: data.country_name,
      region: data.region,
      city: data.city,
      zip: data.postal,
      location: data.region + ', ' + data.city + ', ' + data.country_name,
      latitude: data.latitude,
      longitude: data.longitude,
      timezone: data.timezone,
      current_time: new Date().toLocaleString('en-GB', { timeZone: data.timezone }),
      isp: data.org,
      org: data.org,
      asn: data.asn
    };
  } catch (err) {
    console.error(err);
    return { ip: 'Unknown' };
  }
}

// Function to get browser/system info
function getBrowserInfo() {
  return {
    browser_name: navigator.userAgentData?.brands?.map(b => b.brand).join(', ') || navigator.appName,
    browser_version: navigator.userAgentData?.brands?.map(b => b.version).join(', ') || navigator.appVersion,
    platform_name: navigator.userAgentData?.platform || navigator.platform,
    mobile: /Mobi|Android/i.test(navigator.userAgent) ? 'Yes' : 'No',
    referrer: document.referrer || 'None',
    system_languages: navigator.languages.join(', '),
    screen_width: screen.width + 'px',
    screen_height: screen.height + 'px',
    window_width: window.innerWidth + 'px',
    window_height: window.innerHeight + 'px',
    pixel_depth: screen.pixelDepth,
    orientation: screen.orientation?.type || 'Unknown',
    cpu_threads: navigator.hardwareConcurrency || 'Unknown'
  };
}

// Combine and display visitor info with ping
async function showVisitorInfo() {
  const ping = await getPing(); // Get ping first
  const ipInfo = await getIPInfo();
  const browserInfo = getBrowserInfo();

  const allInfo = {
    "Ping": ping + ' ms',
    "IP Address": ipInfo.ip,
    "Country": ipInfo.country,
    "Region": ipInfo.region,
    "City": ipInfo.city,
    "ZIP Code": ipInfo.zip,
    "Full Location": ipInfo.location,
    "Latitude": ipInfo.latitude,
    "Longitude": ipInfo.longitude,
    "Timezone": ipInfo.timezone,
    "Current Time": ipInfo.current_time,
    "ISP": ipInfo.isp,
    "Organization": ipInfo.org,
    "Autonomous System": ipInfo.asn,
    "Browser Name": browserInfo.browser_name,
    "Platform Name": browserInfo.platform_name,
    "Browser Version": browserInfo.browser_version,
    "Mobile/Tablet": browserInfo.mobile,
    "Referrer": browserInfo.referrer,
    "System Languages": browserInfo.system_languages,
    "Screen Width": browserInfo.screen_width,
    "Screen Height": browserInfo.screen_height,
    "Window Width": browserInfo.window_width,
    "Window Height": browserInfo.window_height,
    "Display Pixel Depth": browserInfo.pixel_depth,
    "Screen Orientation": browserInfo.orientation,
    "CPU Threads": browserInfo.cpu_threads
  };

  const tbody = document.getElementById('info').querySelector('tbody');
  tbody.innerHTML = '';
  for (const [label, value] of Object.entries(allInfo)) {
    const row = document.createElement('tr');
    row.innerHTML = `<td class="label">${label}:</td><td class="value">${value}</td>`;
    tbody.appendChild(row);
  }
}

showVisitorInfo();
</script>
</body>
</html>
